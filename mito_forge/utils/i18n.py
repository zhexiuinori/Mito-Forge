# Centralized i18n utilities for Mito-Forge
# Provide translation helpers used across CLI commands.
# Usage:
#   from ...utils.i18n import t, tl
#   t(key) -> auto-detect language from MITO_LANG
#   t(key, lang='en') -> explicit language
#   tl(lang, key) -> signature compatible wrapper for existing code: _t(lang, key)

import os

# Translation dictionaries
_TEXTS = {
    "zh": {
        # Common
        "error": "错误",
        # Model command
        "no_profiles": "没有找到模型配置",
        "available_profiles": "可用的模型配置:",
        "name": "名称",
        "description": "描述",
        "provider": "提供者",
        "model": "模型",
        "status": "状态",
        "available": "✅ 可用",
        "unavailable": "❌ 不可用",
        "profile_not_exists": "配置不存在",
        "config_label": "配置",
        "testing_config": "测试配置",
        "testing": "测试中...",
        "test_success": "✅ 测试成功!",
        "test_failed": "❌ 测试失败!",
        "set_default_ok": "✅ 已设置默认配置为",
        "add_ok": "✅ 已添加配置",
        "add_fail": "❌ 添加配置失败",
        "confirm_test_new": "是否测试新配置?",
        "update_no_fields": "没有指定要更新的字段",
        "update_ok": "✅ 已更新配置",
        "update_test_success": "✅ 配置测试成功!",
        "update_test_failed": "❌ 配置测试失败",
        "remove_ok": "✅ 已删除配置",
        "presets_available": "可用的预设配置:",
        "api_base": "API 基础",
        "default_model": "默认模型",
        "api_format": "API 格式",
        # Config command
        "reset_ok": "✅ [bold green]配置已重置为默认值[/bold green]",
        "set_ok": "✅ 设置",
        "saved_to": "💾 配置已保存到",
        "cfg_title": "Mito-Forge 配置",
        "list_label": "配置项列表:",
        "desc_label": "说明",
        "not_set": "未设置",
        "file_label": "配置文件",
        "hint_set": "💡 使用 'mito-forge config --set KEY VALUE' 修改配置",
        "desc_threads": "线程数",
        "desc_memory": "内存限制",
        "desc_quality_threshold": "质量阈值",
        "desc_assembler": "默认组装器",
        "desc_annotation_tool": "默认注释工具",
        "desc_output_dir": "默认输出目录",
        "desc_log_level": "日志级别",
        "desc_temp_dir": "临时目录",
        # Pipeline command
        "header": "🧬 Mito-Forge 流水线（LangGraph 版）",
        "input_file": "输入文件",
        "input_file2": "输入文件 (R2)",
        "auto_detect_r2": "自动检测到双端数据 R2",
        "output_dir": "输出目录",
        "kingdom": "物种类型",
        "start": "开始执行流水线...",
        "done": "流水线执行完成",
        "resume_from": "从检查点恢复",
        "summary_title": "📊 流水线执行摘要",
        "pipeline_id": "流水线ID",
        "status_title": "执行状态",
        "status_done": "✅ 完成",
        "status_running": "🔄 进行中",
        "current_stage": "当前阶段",
        "completed_stages": "已完成阶段",
        "duration": "执行时间",
        "seconds": "秒",
        "stage_results": "📋 各阶段结果",
        "metrics": "关键指标",
        "files": "输出文件",
        "more_metrics": "个指标",
        "more_files": "个文件",
        "errors": "错误",
        "warnings": "警告",
        "main_outputs": "主要输出文件",
        "qc_report": "QC 报告",
        "mito_seq": "线粒体序列",
        "assembly_stats": "组装统计",
        "gff": "基因注释 (GFF)",
        "table": "注释表格",
        "final_report": "📊 最终报告",
        # Config help
        "cfg_help_title": "配置管理",
        "cfg_help_desc": "管理 Mito-Forge 的配置参数",
        "cfg_opt_show": "显示当前配置",
        "cfg_opt_set": "设置配置项",
        "cfg_opt_reset": "重置为默认配置",
        "cfg_opt_config_file": "指定配置文件路径",
        # Pipeline help options
        "pl_opt_reads": "输入测序数据文件（R1 或单端）",
        "pl_opt_reads2": "第二个测序文件（双端测序 R2，可选）",
        "pl_opt_output": "输出目录",
        "pl_opt_threads": "线程数",
        "pl_opt_kingdom": "物种类型",
        "pl_opt_resume": "从检查点恢复执行",
        "pl_opt_checkpoint": "检查点保存路径",
        "pl_opt_config_file": "配置文件路径",
        "pl_opt_verbose": "详细输出",
        "pl_opt_interactive": "交互式错误处理",
        "pl_opt_lang": "输出语言",
        # QC help
        "qc.help.desc": "执行质量控制分析",
        "qc.opt.output_dir": "输出目录 (默认: ./qc_results)",
        "qc.opt.quality_threshold": "质量阈值 (默认: 20)",
        "qc.opt.threads": "线程数 (默认: 4)",
        "qc.opt.adapter_removal": "执行接头序列去除",
        "qc.opt.trim_quality": "修剪质量阈值 (默认: 20)",
        "qc.opt.min_length": "最小序列长度 (默认: 50)",
        "qc.opt.report_only": "仅生成质控报告，不进行数据处理",
        # Assembly help
        "asm.help.desc": "执行基因组组装分析",
        "asm.opt.output_dir": "输出目录 (默认: ./assembly_results)",
        "asm.opt.assembler": "组装器选择 (默认: spades)",
        "asm.opt.threads": "线程数 (默认: 4)",
        "asm.opt.memory": "内存限制 (默认: 8G)",
        "asm.opt.k_values": "K-mer值 (默认: 21,33,55,77)",
        "asm.opt.careful_mode": "启用careful模式（更慢但更准确）",
        # Annotate help
        "ann.help.desc": "执行基因注释分析",
        "ann.opt.output_dir": "输出目录 (默认: ./annotation_results)",
        "ann.opt.annotation_tool": "注释工具选择 (默认: mitos)",
        "ann.opt.threads": "线程数 (默认: 4)",
        "ann.opt.genetic_code": "遗传密码表 (默认: 2 - 脊椎动物线粒体)",
        "ann.opt.reference_db": "参考数据库 (默认: mitochondria)",
    },
    "en": {
        # Common
        "error": "Error",
        # Model command
        "no_profiles": "No model profiles found",
        "available_profiles": "Available model profiles:",
        "name": "Name",
        "description": "Description",
        "provider": "Provider",
        "model": "Model",
        "status": "Status",
        "available": "✅ Available",
        "unavailable": "❌ Unavailable",
        "profile_not_exists": "Profile does not exist",
        "config_label": "Profile",
        "testing_config": "Testing profile",
        "testing": "Testing...",
        "test_success": "✅ Test succeeded!",
        "test_failed": "❌ Test failed!",
        "set_default_ok": "✅ Set default profile to",
        "add_ok": "✅ Added profile",
        "add_fail": "❌ Failed to add profile",
        "confirm_test_new": "Test the new profile?",
        "update_no_fields": "No fields specified to update",
        "update_ok": "✅ Updated profile",
        "update_test_success": "✅ Profile test succeeded!",
        "update_test_failed": "❌ Profile test failed",
        "remove_ok": "✅ Removed profile",
        "presets_available": "Available preset profiles:",
        "api_base": "API base",
        "default_model": "Default model",
        "api_format": "API format",
        # Config command
        "reset_ok": "✅ [bold green]Reset to defaults[/bold green]",
        "set_ok": "✅ Set",
        "saved_to": "💾 Config saved to",
        "cfg_title": "Mito-Forge Config",
        "list_label": "Configuration items:",
        "desc_label": "Description",
        "not_set": "Not set",
        "file_label": "Config file",
        "hint_set": "💡 Use 'mito-forge config --set KEY VALUE' to modify",
        "desc_threads": "Threads",
        "desc_memory": "Memory limit",
        "desc_quality_threshold": "Quality threshold",
        "desc_assembler": "Default assembler",
        "desc_annotation_tool": "Default annotation tool",
        "desc_output_dir": "Default output directory",
        "desc_log_level": "Log level",
        "desc_temp_dir": "Temporary directory",
        # Pipeline command
        "header": "🧬 Mito-Forge Pipeline (LangGraph Edition)",
        "input_file": "Input file",
        "output_dir": "Output directory",
        "kingdom": "Kingdom",
        "start": "Starting pipeline...",
        "done": "Pipeline finished",
        "resume_from": "Resume from checkpoint",
        "summary_title": "📊 Pipeline Summary",
        "pipeline_id": "Pipeline ID",
        "status_title": "Status",
        "status_done": "✅ Done",
        "status_running": "🔄 Running",
        "current_stage": "Current stage",
        "completed_stages": "Completed stages",
        "duration": "Duration",
        "seconds": "s",
        "stage_results": "📋 Stage results",
        "metrics": "Key metrics",
        "files": "Output files",
        "more_metrics": "more metrics",
        "more_files": "more files",
        "errors": "Errors",
        "warnings": "Warnings",
        "main_outputs": "Main output files",
        "qc_report": "QC report",
        "mito_seq": "Mitochondrial sequences",
        "assembly_stats": "Assembly stats",
        "gff": "Gene annotation (GFF)",
        "table": "Annotation table",
        "final_report": "📊 Final report",
        # Config help
        "cfg_help_title": "Configuration management",
        "cfg_help_desc": "Manage Mito-Forge configuration parameters",
        "cfg_opt_show": "Show current configuration",
        "cfg_opt_set": "Set configuration item",
        "cfg_opt_reset": "Reset to default configuration",
        "cfg_opt_config_file": "Specify config file path",
        # Pipeline help options
        "pl_opt_reads": "Input sequencing data file (R1 or single-end)",
        "pl_opt_reads2": "Second sequencing file (paired-end R2, optional)",
        "pl_opt_output": "Output directory",
        "pl_opt_threads": "Number of threads",
        "pl_opt_kingdom": "Kingdom",
        "pl_opt_resume": "Resume from checkpoint",
        "pl_opt_checkpoint": "Checkpoint file path",
        "pl_opt_config_file": "Config file path",
        "pl_opt_verbose": "Verbose output",
        "pl_opt_interactive": "Interactive error handling",
        "pl_opt_lang": "Output language",
        # QC help
        "qc.help.desc": "Run quality control analysis",
        "qc.opt.output_dir": "Output directory (default: ./qc_results)",
        "qc.opt.quality_threshold": "Quality threshold (default: 20)",
        "qc.opt.threads": "Threads (default: 4)",
        "qc.opt.adapter_removal": "Perform adapter removal",
        "qc.opt.trim_quality": "Trim quality threshold (default: 20)",
        "qc.opt.min_length": "Minimum read length (default: 50)",
        "qc.opt.report_only": "Generate QC report only, no processing",
        # Assembly help
        "asm.help.desc": "Run genome assembly analysis",
        "asm.opt.output_dir": "Output directory (default: ./assembly_results)",
        "asm.opt.assembler": "Assembler choice (default: spades)",
        "asm.opt.threads": "Threads (default: 4)",
        "asm.opt.memory": "Memory limit (default: 8G)",
        "asm.opt.k_values": "K-mer values (default: 21,33,55,77)",
        "asm.opt.careful_mode": "Enable careful mode (slower but more accurate)",
        # Annotate help
        "ann.help.desc": "Run gene annotation analysis",
        "ann.opt.output_dir": "Output directory (default: ./annotation_results)",
        "ann.opt.annotation_tool": "Annotation tool choice (default: mitos)",
        "ann.opt.threads": "Threads (default: 4)",
        "ann.opt.genetic_code": "Genetic code (default: 2 - Vertebrate mitochondrial)",
        "ann.opt.reference_db": "Reference database (default: mitochondria)",
    },
}

def t(key: str, lang: str | None = None) -> str:
    """Translate a key using specified lang or env MITO_LANG (default zh)."""
    if lang is None:
        lang = os.getenv("MITO_LANG", "zh")
    return _TEXTS.get(lang, _TEXTS["zh"]).get(key, key)

def tl(lang: str, key: str) -> str:
    """Translate with signature tl(lang, key) for backward compatibility."""
    return t(key, lang)